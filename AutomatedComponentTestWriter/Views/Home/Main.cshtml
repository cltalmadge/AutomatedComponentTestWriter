@{
    ViewData["Title"] = "Automated Component Test Writer";
}

<!DOCTYPE html>

<div class="form-group">
    <label for="json object">Input JSON object:</label>
    <textarea id="JSONTextArea" class="form-control"></textarea>
    <table>
        <tr>
            <td>
                <label class="btn btn-outline-primary" for="fileToLoad">
                    <input type="file" id="fileToLoad" accept=".JSON" style="display:none">Browse
                </label>
            </td>
            <td><button id="loadJSON" class="btn btn-primary" onclick="loadFileAsText()">Load Selected File</button></td>
            <td><button class="btn btn-lg" onclick="JSONtoHTMLFields()">Submit</button></td>
        </tr>
    </table>
</div>

<div id="jsonErrField"></div> <!--This is where I am putting any error messages regarding JSON parsing after it is submitted to the application.-->

<div id="mainGUI">

</div>

<script>
    function loadFileAsText() {

        var fileToLoad = document.getElementById("fileToLoad").files[0];

        var fileReader = new FileReader();
        fileReader.onload = function (fileLoadedEvent) {
            var textFromFileLoaded = fileLoadedEvent.target.result;
          
            document.getElementById("JSONTextArea").value = textFromFileLoaded;
        };
        fileReader.readAsText(fileToLoad, "UTF-8");
    }


    function JSONtoHTMLFields() {

        var theJSON = document.getElementById("JSONTextArea").value;
        var printError = function (error, explicit) {
            var err = `[${explicit ? 'EXPLICIT' : 'INEXPLICIT'}] ${error.name}: ${error.message}`;
            $(document).ready(function () {
                //alert("butt");

                $("#jsonErrField").html("<div class=\"alert alert-danger\">" + err + "</div>");
            });
        }
        var idToQuery = "#scum";
        try {
            var json = JSON.parse(theJSON);
            $(document).ready(function () {
                //alert("butt");
                //$("#jsonErrField").html("<div class=\"alert alert-success\"><strong>Success!</strong></div");
                var htmlString = "<div class=\"scrollbar\">";
                for (var key in json) {
                    htmlString += "<div>" + key + " : " + json[key] + "</div>";
                }

                htmlString += "</div><div><button id=\"Generate\" class =\"btn btn-primary\">Generate</button></div>"
                $("#mainGUI").html(htmlString);
                $("#jsonErrField").html("");
            });
        } catch (e) {
            if (e instanceof SyntaxError) {
                printError(e, true);
            }
            else {
                printError(e, false);
            }
        }
    }
</script>
